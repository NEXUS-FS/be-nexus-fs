name: Discord Deployment Notifications

on:
  workflow_run:
    workflows:
      - "Deploy to Railway Dev"
      - "Deploy to Railway Prod"
    types:
      - completed
    branches: [main, dev]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion != 'skipped'
    steps:
      - name: Send Discord success notification
        if: github.event.workflow_run.conclusion == 'success'
        uses: tsickert/discord-webhook@v5.1.0
        with:
          webhook-url: ${{ secrets.DEPLOYMENT_HOOK }}
          username: "GitHub Deployment Bot"
          avatar-url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          embed-title: "âœ… Deployment Successful!"
          embed-color: 5763719
          embed-description: |
            **âœ¨ Status:** Deployed to ${{ github.event.workflow_run.head_branch == 'main' && 'Production' || 'Preview' }}
            **ğŸ‘¤ Deployed by:** ${{ github.event.workflow_run.triggering_actor.login }}
            **ğŸŒ¿ Branch:** `${{ github.event.workflow_run.head_branch }}`
            **ğŸ’¬ Commit Message:** ${{ github.event.workflow_run.head_commit.message }}
            **ğŸ”— [View Workflow Run](${{ github.event.workflow_run.html_url }})**
            **ğŸ“¦ [View Commit](https://github.com/${{ github.repository }}/commit/${{ github.event.workflow_run.head_sha }})**
          embed-footer-text: "Repository: ${{ github.repository }}"
          embed-timestamp: "${{ github.event.workflow_run.updated_at }}"

      - name: Send Discord failure notification
        if: github.event.workflow_run.conclusion == 'failure'
        uses: tsickert/discord-webhook@v5.1.0
        with:
          webhook-url: ${{ secrets.DEPLOYMENT_HOOK }}
          username: "GitHub Deployment Bot"
          avatar-url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          embed-title: "ğŸš¨ Deployment Failed!"
          embed-color: 15158332
          embed-description: |
            **âš ï¸ Status:** Deployment Failed
            **ğŸ‘¤ Triggered by:** ${{ github.event.workflow_run.triggering_actor.login }}
            **ğŸŒ¿ Branch:** `${{ github.event.workflow_run.head_branch }}`
            **ğŸ’¬ Commit Message:** ${{ github.event.workflow_run.head_commit.message }}
            **ğŸ”— [View Workflow Run](${{ github.event.workflow_run.html_url }})**
            **ğŸ“¦ [View Commit](https://github.com/${{ github.repository }}/commit/${{ github.event.workflow_run.head_sha }})**
          embed-footer-text: "Repository: ${{ github.repository }}"
          embed-timestamp: "${{ github.event.workflow_run.updated_at }}"