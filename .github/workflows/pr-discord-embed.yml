name: Notify Discord on Pull Request

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: >
      github.event.pull_request.base.ref == 'dev' &&
      github.event.pull_request.head.ref != 'dev' &&
      !contains(github.event.pull_request.title || '', "Merge branch 'dev'") &&
      !contains(github.event.pull_request.title || '', 'merge dev') &&
      !contains(github.event.pull_request.body || '', 'Merged via the queue')

    steps:
      - name: Determine event type
        id: event_type
        run: |
          if [ "${{ github.event.action }}" = "opened" ]; then
            echo "message_type=opened" >> $GITHUB_OUTPUT
          else
            echo "message_type=updated" >> $GITHUB_OUTPUT
          fi

      - name: Send Discord notification
        uses: tsickert/discord-webhook@v5.1.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          username: "GitHub PR Bot"
          avatar-url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          embed-title: ${{ steps.event_type.outputs.message_type == 'opened' && '🚀 New Pull Request Opened!' || '🔄 Pull Request Updated!' }}
          embed-color: ${{ steps.event_type.outputs.message_type == 'opened' && 5814783 || 16776960 }}
          embed-description: |
            **👤 Author:** ${{ github.actor }}
            **🔀 Branch:** `${{ github.head_ref }} → ${{ github.base_ref }}`
            **📝 Title:** ${{ github.event.pull_request.title }}
            **🔗 [View Pull Request](${{ github.event.pull_request.html_url }})**
          embed-footer-text: "Repository: ${{ github.repository }}"
          embed-timestamp: "${{ github.event.pull_request.updated_at }}"
